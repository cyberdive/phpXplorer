/***************************************************************
*  Copyright notice
*
*  (c) 2003-2005 Tobias Bender (tobias@phpxplorer.org)
*  All rights reserved
*
*  This script is part of the phpXplorer project. The phpXplorer project is
*  free software; you can redistribute it and/or modify
*  it under the terms of the GNU General Public License as published by
*  the Free Software Foundation; either version 2 of the License, or
*  (at your option) any later version.
*
*  The GNU General Public License can be found at
*  http://www.gnu.org/copyleft/gpl.html.
*  A copy is found in the textfile GPL.txt distributed with these scripts.
*
*  This script is distributed in the hope that it will be useful,
*  but WITHOUT ANY WARRANTY; without even the implied warranty of
*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*  GNU General Public License for more details.
*
*  This copyright notice MUST APPEAR in all copies of the script!
***************************************************************/al=Array("left","center","right","justify");valHalt=false;_ie6=(navigator.userAgent.indexOf('MSIE 6.0')>-1);function gridBox(id){this.id=id;this.grids=new Array();this.aGrids=new Array();this.gGrids=new Array();this.cTmps=new Array();this.cETmps=new Array();this.cTmpM=new Array();this.iF=false;this.K=0;this.E=new Array();this.dragS=-1;this.dragT=-1;this.tbH=35;};function grid(id,title,bgCol,actCol,cs,cp,border,rules,frame,align,G,H,I,aEdit,J,C,D,_m,B,L,_7,sR,expa,glbId){this.id=id;this.title=title;this.__m=_m;this._B=B;this._C=C;this._D=D;this.bgCol=bgCol;this.actCol=actCol;this.cs=cs;this.cp=cp;this.border=border;this.rules=rules;this.frame=frame;this.align=align;this.G=G;this.H=H;this.I=I;this.aEdit=aEdit;this.J=J;this.cols=new Array();this.aCols=new Array();this.rows=new Array();this._3=new Array();this.y=-1;this.M=new Array();this._c=new Array();this.L=L;this.R=new Array();this._7=_7;this.sR=sR;this.expa=expa;this._8=new Array();this.glbId=glbId;return this;};function column(idx,g,id,S,ea,vl,format,len,title,ctl,vi,align,width,bgColor,path,type,ml,Q,keyGen,optCond){this.id=id;this.idx=idx;this.ml=ml;this.type=type;this.T=idx;this.ctl=ctl;this.title=title;this.S=S;this.Q=Q;this.keyGen=keyGen;this.align=align;this.width=width;this.bgColor=bgColor;this.vi=vi;this.ea=ea;this.vl=vl;this.path=path;this.format=format;this.len=len;this.optCond=optCond;this.grid=g;this.A=new Array();this.nValues=new Array();return this;};gridBox.prototype.resize=function(){var nH=(document.all)?document.body.offsetHeight:window.innerHeight;nH-=this.tbH;if(this.lH!=nH){this.lH=nH;if(nH>0)document.getElementById(this.id+"Content").style.height=nH+"px";};};gridBox.prototype.moveFoc=function(up){if(this.actGrid&&this.alt){if(this.actGrid.actCell.id!='')return;var tr=this.actGrid.actCell.parentNode;if(up){if(tr.previousSibling.previousSibling);this.actGrid.actCell=tr.previousSibling.previousSibling.childNodes[1+this.actGrid._4()];}else{if(tr.nextSibling.nextSibling);this.actGrid.actCell=tr.nextSibling.nextSibling.childNodes[1+this.actGrid._4()];};__wGSFF(this.actGrid.actCell);};};gridBox.prototype.refresh=function(){location.href=location.href};gridBox.prototype._d=function(rId){var g=this.grids;for(var i in g)if(g[i].rows[g[i].transRId(rId)])return g[i];};gridBox.prototype.setRowColor=function(rId,c){var f=this.E;for(var i in f)if(rId==f[i]){c="";var p=i;break};if(rId){this._e(rId,c);if(c==""){f[p]=null}else{f[f.length]=rId};}else{for(var i in f)this._e(f[i],"");this.E=new Array();};};gridBox.prototype._e=function(rId,c,mTr){var n=this.getTr(rId);var g=this._d(rId);if(!n)return;if(mTr){n.style.backgroundColor=c;}else{n=n.childNodes;for(var i=0;i<g.cols.length;i++){var j=g.cols[i];if(n[1+j.idx])if(j.ctl!=7&&j.ctl!=8&&j.ctl!=16)n[1+j.idx].style.backgroundColor=(j.bgColor!=''&&j.bgColor!='#'&&c=='')?j.bgColor:c;};};};gridBox.prototype.addGd=function(g,p,k){g.gB=this;var u=this.wgURL;g._m=new Image();g._m.src=u+"/"+g.__m;g.B=new Image();g.B.src=u+"/"+g._B;g.C=new Image();g.C.src=u+"/"+g._C;g.D=new Image();g.D.src=u+"/"+g._D;if(this.onAddGrid)this.onAddGrid();g.idx=(g==p)?p.idx:this.grids.length;g.parent=p;if(!g.inited){g._9="gridBox.grids["+g.idx+"]";this.grids[this.grids.length]=g;this.aGrids[g.id]=g;this.gGrids[g.glbId]=g;g.inited=true;};if(p){if(!g.stTable)g.stTable=p.stTable;if(!g.stCaption)g.stCaption=p.stCaption;if(!g.stTh)g.stTh=p.stTh;if(!g.stTd)g.stTd=p.stTd;if(!g.stInputBox)g.stInputBox=p.stInputBox;if(!g.stSelect)g.stSelect=p.stSelect;if(!g.stRadio)g.stRadio=p.stRadio;if(!g.stCheckbox)g.stCheckbox=p.stCheckbox;if(!g.stTextarea)g.stTextarea=p.stTextarea;if(!g.stA)g.stA=p.stA;if(!g.stButton)g.stButton=p.stButton;var c=p.M;c[c.length]=g;c=p._c;c[c.length]=k;};};gridBox.prototype.init=function(){if(this.iF)return;this.iF=true;var z="var j=gridBox.grids[gIdx].aCols[_f];";var w="var j=gridBox.grids[gIdx];";var c="<html><head><title>WebGrid</title><script type='text/javascript'>\ngridBox=parent."+this.id+";"+"_aF=null;_aFDS=null;_aFW=0;_aFH=0;_aFX=0;_aFY=0;function moveDiv(e){"+"var z=document.body;var a=document.all;var s=gridBox.dragSpan.style;"+"wGX=(a)?event.x+z.scrollLeft:e.pageX;wGY=(a)?event.y+z.scrollTop:e.pageY;"+"s.top=wGY+5;s.left=wGX+5;if(_aFDS==true){var x=_aFW+(wGX-_aFX);if(x>0)_aF.style.width=x;var y=_aFH+(wGY-_aFY);if(y>0)_aF.style.height=y}}"+"function bodyUp(b){var j=gridBox;if(j.onBodyUp)j.onBodyUp(b)}"+"function bodyKeyPress(b,e){var j=gridBox;if(j.onBodyKeyPress)j.onBodyKeyPress(b,e)}"+"function bodyKeyUp(b,e){var j=gridBox;if(j.onBodyKeyUp)j.onBodyKeyUp(b,e)}"+"function bodyKeyDown(b,e){var j=gridBox;if(j.onBodyKeyDown)j.onBodyKeyDown(b,e)}"+"function capOut(cap,gIdx){"+w+"if(j.onCapOut)j.onCapOut(cap)}"+"function capOver(cap,gIdx){"+w+"if(j.onCapOver)j.onCapOver(cap)}"+"function capDown(cap,gIdx){"+w+"if(j.onCapDown)j.onCapDown(cap)}"+"function capMove(cap,gIdx){"+w+"if(j.onCapMove)j.onCapMove(cap)}"+"function capUp(cap,gIdx){"+w+"if(j.onCapUp)j.onCapUp(cap)}"+"function capDblClick(cap,gIdx){"+w+"if(j.onCapDblClick)j.onCapDblClick(cap)}"+"function capClick(cap,gIdx){"+w+"if(j.onCapClick)j.onCapClick(cap)}"+"function thOut(th,gIdx,_f){"+z+"if(j.onThOut)j.onThOut(th)}"+"function thOver(th,gIdx,_f){"+z+"if(j.onThOver)j.onThOver(th)}"+"function thDown(th,gIdx,_f){"+z+"if(j.onThDown)j.onThDown(th)}"+"function thMove(th,gIdx,_f){"+z+"if(j.onThMove)j.onThMove(th)}"+"function thUp(th,gIdx,_f){"+z+"if(j.onThUp)j.onThUp(th)}"+"function thDblClick(th,gIdx,_f){"+z+"if(j.onThDblClick)j.onThDblClick(th)}"+"function thClick(th,gIdx,_f){"+z+"if(j.onThClick)j.onThClick(th)}"+"function tdOut(td,gIdx,_f,rId){"+z+"if(j.onTdOut)j.onTdOut(td,rId)}"+"function tdMove(td,gIdx,_f,rId){"+z+"if(j.onTdMove)j.onTdMove(td,rId)}"+"function tdOver(td,gIdx,_f,rId){"+z+"if(j.onTdOver)j.onTdOver(td,rId)}"+"function tdUp(td,gIdx,_f,rId){"+z+"if(j.onTdUp)j.onTdUp(td,rId)}"+"function tdDown(td,gIdx,_f,rId){"+z+"if(j.onTdDown)j.onTdDown(td,rId)}"+"function tdDblClick(td,gIdx,_f,rId){"+z+"if(j.onTdDblClick)j.onTdDblClick(td,rId)}"+"function tdClick(td,gIdx,_f,rId){gridBox.grids[gIdx].aCols[_f].tdClick(td,rId)}"+"function __(){}\n"+"</script><style type='text/css'>"+this.stGlobal+"\n";for(var i in this.grids){var g=this.grids[i];var r=g.rows;for(var i=0;i<g.rC;i++)r[r.length]=this._1();for(var k in g.cols){g.cols[k].vs=g.cols[k].vs.slice(0,g.cols[k].vs.length-1);g.cols[k].vsS=new Array(g.cols[k].vs.length);};if(g.bTpl)g.bTpl=g.bTpl.replace(/{@nbsp}/g,"&nbsp;");var n=g.id;c+=((g.stInputBox)?"input.iB"+n+"{"+g.stInputBox+"}\n":"")+((g.stRadio)?"input.rB"+n+"{"+g.stRadio+"}\n":"")+((g.stCheckbox)?"input.cB"+n+"{"+g.stCheckbox+"}\n":"")+((g.stSelect)?"select."+n+"{"+g.stSelect+"}\n":"")+"td."+n+"{"+g.stTd+"}\n"+"th."+n+"{"+g.stTh+"}\n"+"caption."+n+"{"+g.stCaption+"}\n"+((g.stTable)?"table."+n+"{"+g.stTable+"}\n":"")+((g.stTextarea)?"textarea."+n+"{"+g.stTextarea+"}\n":"")+((g.stButton)?"button."+n+"{"+g.stButton+"}\n":"")+((g.stA)?"a."+n+"{"+g.stA+"}\n":"");};c+="</style></head><body onKeyPress=\"bodyKeyPress(this,event)\" onKeyUp=\"bodyKeyUp(this,event)\" onKeyDown=\"bodyKeyDown(this,event)\" style=\"background-color:"+((this.grids[0])?this.grids[0].bgCol:"#FFFFFF")+"\" onload=\"document.onmousemove=moveDiv\" "+"onmouseup=\"bodyUp(this)\"><span id=\"wGMoverDiv\"></span><form action=\"\" onsubmit=\"return false\">";this.fixC=c;if(this.initialize)this.initialize();if(window.frames[this.id+'Sync'])window.frames[this.id+'Sync'].location.href=location.href+((location.href.indexOf("?")>-1)?"&actionType=S":"?actionType=S");};gridBox.prototype.render=function(frm,key,gIdx,_f){if(frm)this.frm=frm;this.doc=this.frm.document;if(this.key)key=this.key;var d=this.doc;this.init();var c="";var e=d.body.innerHTML=='';for(var i in this.grids){var g=this.grids[i];if(!g.parent||g.recursive){if(e){c+="<span>"+((gIdx==g.idx)?g.gT(key,_f):g.gT(key,null))+"</span>";}else{if(g.idx==gIdx)d.forms[0].childNodes[i].innerHTML=g.gT(key,_f);};};};if(c!=""){d.open();d.write(this.fixC+c+"</form></body></html>");d.close();};var k=0;for(var i in this.grids){var g=this.grids[i];if(!g.parent||g.recursive){g.tB=d.getElementsByTagName("table")[k].childNodes[1];for(var j in g.cols)if(g.cols[j].onValueChange)g.cols[j].onValueChange();k+=1;};};this.dragSpan=d.getElementById("wGMoverDiv");if(this.dragSpan)this.dragSpan.style.display='none';if(this.onLoad)this.onLoad();var g=this.grids[0];if(g){var r=g.rows;if(r.length > 0){var i=g._4();var c=g.cols[i];if(c);c.tdClick(this.getTr(r[0]).childNodes[i+1], r[0]);};};};grid.prototype.expandAll=function(){var key=this.tB.parentNode.id;for(var r in this.rows){if(this.evalKey(key,r))this.expand(this.rows[r],this.idx,'');};};grid.prototype.expand=function(rId,gIdx,_f){if(valHalt)return;var nd=this.gB.getTr(rId);if(this.onExpand)if(this.onExpand(nd,rId,_f)==false)return;this.tB=nd.parentNode;var tr=nd.nextSibling;var m=tr.childNodes[1];var k=this.M;if((!tr.style.display)&&(_f==null)){tr.style.display="none";var im=this.C;}else{var im=this.D;if(_f!=null||m.childNodes.length==0){var c="";if(m.childNodes.length==0){for(var i in k)c+="<span>"+k[i].gT(this.O(i,this.transRId(rId)),((k[i].idx==gIdx)?_f:null))+"</span>";}else{for(var i in k)if(k[i].idx==gIdx)m.childNodes[i].innerHTML=k[i].gT(this.O(i,this.transRId(rId)),_f);};if(c!='')m.innerHTML=c;};tr.style.display="";};for(var i in k){k[i].tB=m.childNodes[i].childNodes[1].childNodes[1];for(var j in k[i].cols)if(k[i].cols[j].onValueChange)k[i].cols[j].onValueChange();};nd.firstChild.firstChild.innerHTML="<img src='"+im.src+"' border='0' hspace='2'>";};gridBox.prototype.expandAll=function(){if(this.actGrid)this.actGrid.expandAll()};gridBox.prototype.addRow=function(){if(this.actGrid)this.actGrid.addRow()};gridBox.prototype.insRow=function(){if(this.actGrid)this.actGrid.insRow()};gridBox.prototype.delRow=function(){var r=this.E;for(var f in r){var i=r[f];if(i){var tr=this.getTr(i);if(tr){var t=tr.parentNode.parentNode;var g=this.aGrids[t.className];g.tB=t.tBodies[0];g.delRow(i,(f==r.length-1)?true:false);};};};};gridBox.prototype.F=function(){var upd=new Array();var del=new Array();var ins=new Array();for(var i in this.grids){var g=this.grids[i];for(var r in g.rows){var z=g.gRS(g.rows[r]);if(z != "" && String(z) != "undefined"){var c = g.id;c += "<~>";c += z;c += "<~>";c += g.rows[r];c += "<!>";vC = new Array();for(var m in g.cols){for(var j in g.cols){if(g.cols[j].T == m){vC[vC.length] = ((g.cols[j].vsS[r] != null)?g.cols[j].vsS[r] + "<_>":"") + g.cols[j].vs[r];break;};};};c += vC.join("<~>");switch(z){case "d": del[del.length] = c; break;case "i": ins[ins.length] = c; break;case "u": upd[upd.length] = c; break;};};};};del.reverse();del=del.concat(ins);del=del.concat(upd);return del.join("<|>");};gridBox.prototype.sync=function(){if(valHalt)return;if(this.onSync)if(!this.onSync())return;valHalt=true;var f=window.frames[this.id+'Sync'].document.forms['frm1'];f.data.value=this.F();f.submit();valHalt=false;};grid.prototype.addGd=function(g,k){var c=this.M;c[c.length]=g;c=this._c;c[c.length]=k;};grid.prototype.gT=function(key,_f){var A=0;var cS=new Array();if(_f=='')_f=null;if(!key)key=null;var c1=new Array();var r=this.rows;U=new Array();if(!_f){if(this.R[key])_f=this.R[key];if(_f)var nc=true;};for(var y in r){if(this.gRS(r[y])=="d")continue;if(this.evalKey(key,y))U[U.length]=new Array(((_f)?this.aCols[_f].vs[y]:null),y);};var sl=U.length;if(_f){if(!nc){if(_f==this._l)A=(this.aCols[_f].A[key]==0)?1:0;this.aCols[_f].A[key]=A;}else{A=this.aCols[_f].A[key];};this._l=_f;cS[_f]="<img src='"+((A==0)?this._m.src:this.B.src)+"'>";this.R[key]=_f;}else{if(this.orderBy){var s=this.orderBy.split(",");for(var i in s){var z=s[i].indexOf(" ");var w=((z>-1)?s[i].substr(0,z):s[i]);A=(s[i].toUpperCase().indexOf("DESC")>-1)?1:0;this.aCols[w].A[key]=A;this._l=w;cS[w]="<img src='"+((A==0)?this._m.src:this.B.src)+"'>";};};};if(this.sR=='G')U=this.sortAr(_f,A,U);var tp="";var ti="";var tn="";var tc="";var tsc="";if(this._7>0&&sl>this._7){var pg=Math.round(sl/this._7+0.455555555);var _8=(this._8[key])?this._8[key]:0;var pos=_8/this._7;if(!this.allPages){tn=(pos+1<pg)?'<span title="Next page" style="cursor:pointer" onClick="var g=gridBox.grids[{@@idx}];g._8[\''+key+'\']='+(_8+this._7)+';g.refresh(this)">>></span>':'<span style="color:#888888">>></span>';tp=(pos>0)?'<span title="Previous page" style="cursor:pointer" onClick="var g=gridBox.grids[{@@idx}];g._8[\''+key+'\']='+(_8-this._7)+';g.refresh(this)"><<</span>':'<span style="color:#888888"><<</span>';tc=U.length;tsc=pg;for(var d=0;d<pg;d++)ti+=' <span style="cursor:pointer;'+((d==pos)?'color:#CC3333':'')+'" onClick="var g=gridBox.grids[{@@idx}];g._8[\''+key+'\']='+(d*this._7)+';g.refresh(this)">'+(d+1)+'</span> ';};U=U.slice(_8,_8+this._7);};var cp="";if(this.cTpl){cp=this.cTpl;cp=cp.replace(/{@@addRow}/g,((this.I)?'<span style="cursor:pointer;font-weight:normal" title="Add row" onClick="gridBox.grids[{@@idx}].tB=this.parentNode.nextSibling;gridBox.grids[{@@idx}].addRow()">[Add row]</span>':''));cp=cp.replace(/{@@title}/g,'<span style="cursor:pointer" title="Hide" onClick="this.parentNode.parentNode.previousSibling.style.display=\'\';this.parentNode.parentNode.style.display=\'none\'">'+this.title+'</span>').replace(/{@@previousTmp}/g,tp).replace(/{@@indexTmp}/g,ti).replace(/{@@nextTmp}/g,tn).replace(/{@@idx}/g,this.idx).replace(/{@@rowCount}/,tc).replace(/{@@pageCount}/,tsc);};var p="(this,"+this.idx+") '";c1[0]='<table'+((this.expa)?' style="display:none"':'')+'><caption style="cursor:pointer" class="'+this.id+'"><span title="Ausklappen" onClick="this.parentNode.parentNode.style.display=\'none\';this.parentNode.parentNode.nextSibling.style.display=\'\'">('+this.title+')</span></caption></table><table'+((key)?" id='"+key+"' ":"")+((this.align!='')?" align=\""+this.align+"\"":"")+' class="'+this.id+'" cellspacing="'+this.cs+'" cellpadding="'+this.cp+'" border="'+this.border+'" '+((this.rules=='all')?'':'rules="'+this.rules+'"')+' frame="'+this.frame+'"'+((this.expa)?'':' style="display:none"')+'>'+((this.G)?"<caption "+((this.onCapMove)?"onMouseMove='capMove"+p:"")+((this.onCapUp)?"onMouseUp='capUp"+p:"")+((this.onCapClick)?"onClick='capClick"+p:"")+((this.onCapOver)?"onMouseOver='capOver"+p:"")+((this.onCapOut)?"onMouseOut='capOut"+p:"")+((this.onCapDblClick)?"onDblClick='capDblClick"+p:"")+((this.onCapDown)?"onMouseDown='capDown"+p:"")+"class='"+this.id+"'>"+cp+"</caption>":"");c1[c1.length]="<tbody>";if(this.H){c1[c1.length]="<tr><th class='"+this.id+"'></th>";var k=this.cols;for(var x in k){var aC=k[x];if(!cS[aC.id])cS[aC.id]='';c1[c1.length]="<th ";var p="(this,"+this.idx+",'"+aC.id+"')\"";c1[c1.length]=((aC.onThMove)?" onMouseMove=\"thMove"+p:"")+((aC.onThUp)?" onMouseUp=\"thUp"+p:"")+((aC.onThClick)?" onClick=\"thClick"+p:"")+((aC.onThOver)?" onMouseOver=\"thOver"+p:"")+((aC.onThOut)?" onMouseOut=\"thOut"+p:"")+((aC.onThDblClick)?" onDblClick=\"thDblClick"+p:"")+((aC.onThDown)?" onMouseDown=\"thDown"+p:"")+" onselectstart='return false' ";c1[c1.length]="class='"+this.id+"' style='"+((!aC.vi)?"display:none":"")+"'><nobr>&nbsp;"+aC.title+"&nbsp;"+cS[aC.id]+"&nbsp;</nobr></th>";};c1[c1.length]="</tr>";};if(this.sR=='P')U=this.sortAr(_f,A,U);_n=1;for(var a in U){var y=U[a][1];c1[c1.length]=this.X(y,r[y],_n);if(_n==2)_n=0;_n+=1;};var c2=c1.join("")+"</tbody>"+((this.fTpl)?"<tfoot class=\""+this.id+"\">"+this.fTpl.replace(/{@gridId}/g,this.id).replace(/{@nbsp}/g,"&nbsp;").replace(/{@@previousTmp}/g,tp).replace(/{@@indexTmp}/g,ti).replace(/{@@nextTmp}/g,tn).replace(/{@@idx}/g,this.idx)+"</tfoot>":"")+"</table>";var o=this._8;if(!o[key])o[key]=0;if(this.allPages){var tmc=this.cTpl;this.cTpl="&nbsp;";if((!(o[key]+this._7>=sl))){o[key]+=this._7;c2+=this.gT(key,_f);}else{o[key]=0;};this.cTpl=tmc;};return c2;};grid.prototype.sortAr=function(_f,A,U){if(_f!=null){var a=this.aCols[_f].sort;if(a){U.sort(a)}else{U.sort()};if(A==1)U.reverse();};return U;};grid.prototype.X=function(y,rId,_n){var k=this.cols;var t="";var rId=this.rows[y];var cd=new Array();cd[0]='<tr id="'+rId+'" class="'+this.id+_n+'"><td class="'+this.id+'">'+((this.M.length>0)?'<a href="javascript:'+this._9+'.expand('+rId+')"><img src="'+this.C.src+'" border="0" hspace="2"></a>':'')+'</td>';if(this.bTpl){cd[1]='<td onClick="tdClick(this,'+this.idx+',\''+this.cols[0].id+'\','+rId+')" class="'+this.id+'" style="text-align:left">'+this.bTpl+'</td>';for(var x in k)cd[1]=k[x].gCellCode(y,rId,true,cd[1]);}else{for(var x in k){var aC=k[x];if(aC.S)t+=aC.title+"="+String(aC.vs[y])+" ";};for(var x in k){var aC=k[x];var w=(aC.width>0)?"width:"+aC.width+"px;":"";var p="(this,"+this.idx+",'"+aC.id+"',"+rId+")\"";var b=(aC.bgColor!=''&&aC.bgColor!='#')?"background-color:"+aC.bgColor+";":"";cd[cd.length]="<td "+((aC.onTdOut)?" onMouseOut=\"tdOut"+p:"")+((aC.onTdOver)?" onMouseOver=\"tdOver"+p:"")+((aC.onTdMove)?" onMouseMove=\"tdMove"+p:"")+((aC.onTdUp)?" onMouseUp=\"tdUp"+p:"")+((aC.onTdDown)?" onMouseDown=\"tdDown"+p:"")+((aC.onTdDblClick)?" onDblClick=\"tdDblClick"+p:"")+"onClick=\"tdClick(this,"+this.idx+",'"+aC.id+"',"+rId+")\" style='"+b+w+"text-align:"+aC.align+";"+((!aC.vi)?"display:none":"")+"' class='"+this.id+"' title='"+aC.title+"::"+t+"'>"+aC.gCellCode(y,rId,false)+"</td>";};};cd[cd.length]="</tr><tr id='sub"+rId+"' style='display:none'><td>&nbsp;</td><td style='background-color:"+((this.M.length>0)?this.M[0].bgCol:this.bgCol)+"' colspan='"+this._5()+"'></td></tr>";return cd.join("");};grid.prototype.changeCol=function(th,f,t){if(f==t)return;var ff=this.cols[f];var nC=new Array();for(var c in this.cols){if(c==t){nC[nC.length]=ff;nC[nC.length]=this.cols[c];}else{if(c!=f)nC[nC.length]=this.cols[c];};};this.cols=nC;delete nC;for(var c in this.cols)this.cols[c].idx=Number(c);this.sort(th,'');};grid.prototype.sort=function(th,_f){if(valHalt)return;var b=this.gB;var n=th;while(n!=null){if(n.id)if(n.id.substr(0,3)=="sub")break;n=(n.parentNode)?n.parentNode:null;};if(n){n=n.previousSibling;this.parent.expand(n.id,this.idx,_f);}else{b.render(window.frames[this.id+"Content"],null,this.idx,_f);};};grid.prototype.refresh=function(cap){if(cap)this.tB=cap.parentNode.nextSibling;this.sort(this.tB,'');};column.prototype.updValue=function(v,y,rId){var b=this.gB;var g=this.grid;var u=this.vs[y]!=v;var oV=this.vs[y];this.vs[y]=v;if(u){g.sRS(rId,"u");if(g.gRS(rId)!="i"&&this.vsS[y]==null)this.vsS[y]=oV;if(this.onValueChange)this.onValueChange();if(b.onValueChange)b.onValueChange();};};column.prototype.hdCtl=function(rId,v){var g=this.grid;var l=this.ctl;var y=g.transRId(rId);var b=this.gB;if(this.afterValueEdit)v=this.afterValueEdit(y,rId,v);if(g.actCell)g.actCell.id='';if(this.validate)if(this.validate(v,rId)==false){valHalt=true;if(!g.bTpl){window.aTd=g.actCell;window.setTimeout("__wGSFF(window.aTd)",30);};return true;};valHalt=false;if(v||String(v)=='')if(!this.gB.cTmpM[l]){this.updValue(v,y,rId);}else{var z="";var oc=-1;var sel = false;for(var h=0;h<this.options.length;h++){if(!this.chkOptCond(y,h))continue;oc++;if(v.options[oc].selected){sel = true;z+=((this.values)?this.values[h]:v.options[oc].text)+this.format;};};z=z.substr(0,z.length-1);if(!sel) z = null;this.updValue(z,y,rId);};if(!g.bTpl){var nd=b.getTr(rId).childNodes[1+this.idx];nd.innerHTML=this.gCellCode(y,rId,false);if(_ie6&&b.tab)window.setTimeout("__wGSFF(window.aTd."+((b.shift)?"previousSibling":"nextSibling")+")",150);};};column.prototype.tdClick=function(td,rId){var g=this.grid;if(valHalt)return;g.actCell=td;g.gB.actGrid=g;g.tB=Z(td,'TBODY');window.aTd=td;var y=g.transRId(rId);if(this.onBeforeTdClick)this.onBeforeTdClick(td,y,rId);if(this.onTdClick)this.onTdClick(td,y,rId);if(g.y!=y)if(g.onRowChange)g.onRowChange(g.y,y,rId);g.y=y;};column.prototype.chkOptCond=function(y,oY){if(this.optCond!=''){var a=this.optCond.split(";");for(var z=0;z<this.nValues.length;z++){var d=this.nValues[z][oY];if(this.nValues[z])if(d!=null){b=a[z].split('||');var res=false;for(var x=0;x<b.length;x++){var t=b[x].substr(0,1);if(t=="'"||t=='"'){if(d==b[x].substr(1,b[x].length-2))res=true;}else{if(d==this.grid.aCols[b[x]].vs[y])res=true;};};if(!res)return false;};};};return true;};column.prototype.gCellCode=function(y,rId,s,q){var g=this.grid;if(g.bTpl){rTX=new RegExp("{@"+this.id+".","g");var t=q.replace(rTX,"{@");}else{var t=(s)?this.gB.cETmps[this.ctl]:this.gB.cTmps[this.ctl];};var e=String(this.vs[y]).split(this.format);var r="";if(this.values){for(var f in e)for(var v in this.values)if(e[f]==this.values[v])r+=this.options[v]+this.format;r=r.substr(0,r.length-1);}else{r=e.join(this.format)};if(s){if(this.beforeValueEdit)r=this.beforeValueEdit(y,rId,r);if(this.options){var j="";for(var o in this.options){if(!this.chkOptCond(y,o))continue;var v=(this.values)?this.values[o]:this.options[o];for(var q in e){var s=(((this.values)?this.values:this.options)[o]==e[q])?" selected":"";if(s!="")break};j+="<option value='"+v+"'"+s+">"+this.options[o]+"</option>";};t=t.replace(/{@options}/g,j);};t=t.replace(/{@onBlur}/g,'{@gridPath}.aCols[\'{@id}\'].hdCtl({@rId},');}else{if(this.vl>0&&r.length>this.vl)r=r.substr(0,this.vl)+" ...";if(this.beforeValueView)r=this.beforeValueView(y,rId,r);};if(t.indexOf("{@maxLen}")>-1)t=t.replace(/{@maxLen}/g,this.ml);if(t.indexOf("{@format}")>-1)t=t.replace(/{@format}/g,this.format);if(t.indexOf("{@length}")>-1)t=t.replace(/{@length}/g,this.len);if(t.indexOf("{@checked}")>-1)t=t.replace(/{@checked}/g,(this.vs[y])?" checked=\"checked\"":"");if(t.indexOf("{@disabled}")>-1)t=t.replace(/{@disabled}/g,((!this.ea||(g.bTpl&&g.gRS(rId)!="i"&&g.aEdit==false))?' disabled="disabled"':""));if(t.indexOf("{@action}")>-1)t=t.replace(/{@action}/g,"{@gridPath}.aCols[\'{@id}\'].action({@y},{@rId})");if(t.indexOf("{@eventAction}")>-1){var ev=document.all?"window.":"";t=t.replace(/{@eventAction}/g,"{@gridPath}.aCols[\'{@id}\'].action({@y},{@rId},this,"+ev+"event)")};if(t.indexOf("{@y}")>-1)t=t.replace(/{@y}/g,y);if(t.indexOf("{@rId}")>-1)t=t.replace(/{@rId}/g,rId);if(t.indexOf("{@id}")>-1)t=t.replace(/{@id}/g,this.id);if(t.indexOf("{@gridId}")>-1)t=t.replace(/{@gridId}/g,g.id);if(t.indexOf("{@gridPath}")>-1)t=t.replace(/{@gridPath}/g,g._9);if(this.ctl>7||this.grid.bTpl!=""){if(t.indexOf("{@wgURL}")>-1)t=t.replace(/{@wgURL}/g,this.gB.wgURL);if(t.indexOf("{@ImageEditorURL}")>-1)t=t.replace(/{@ImageEditorURL}/g,this.gB.ImageEditorURL);if(t.indexOf("{@HTMLAreaURL}")>-1)t=t.replace(/{@HTMLAreaURL}/g,this.gB.HTMLAreaURL);if(t.indexOf("{@JSCalendarURL}")>-1)t=t.replace(/{@JSCalendarURL}/g,this.gB.JSCalendarURL);if(t.indexOf("{@location}")>-1)t=t.replace(/{@location}/g,location.href.substr(0,location.href.lastIndexOf("/")));if(t.indexOf("{@eventAction}")>-1){var ev=document.all?"window.":"";t=t.replace(/{@eventAction}/g,"{@gridPath}.aCols[\'{@id}\'].action({@y},{@rId},this,"+ev+"event)")};if(t.indexOf("{@title}")>-1)t=t.replace(/{@title}/g,this.title);};if(t.indexOf("{@condStyle}")>-1)t=(this.condStyle)?t.replace(/{@condStyle}/g,this.condStyle(y,rId)):t.replace(/{@condStyle}/g,"");r=String(r);if(r.indexOf('"')>-1)r=r.replace(/\"/g,'&quot;');if(r.indexOf('<')>-1)r=r.replace(/</g,'&lt;');if(r.indexOf('>')>-1)r=r.replace(/>/g,'&gt;');return t.replace(/{@values}/g,r);};grid.prototype.addCol=function(id,S,ea,vl,format,len,title,ctl,vi,align,width,bgColor,path,type,ml,Q,keyGen,optCond){var s=this.cols;if(this.gB.cTmpM[ctl]){if(format=='')format=' ';};s[s.length]=new column(s.length,this,id,S,ea,vl,format,len,title,ctl,vi,al[align],width,bgColor,path,type,ml,Q,keyGen,optCond);var c=s[s.length-1];this.aCols[String(id)]=c;c.action=function(y,rId){};c.gB=this.gB;if(this.gB.onAddColumn)this.gB.onAddColumn(c,this);if(this.onAddColumn)this.onAddColumn(c);return c;};grid.prototype.insRow=function(_b){return this._a(_b,false)};grid.prototype.addRow=function(_b){return this._a(_b,true)};grid.prototype._a=function(_b,ad){var g=this;var b=g.gB;if((valHalt&&(!b._kH))||b._kL)return;if(!this.I&&!_b){alert("You are not allowed to add rows.");return false};if(g.beforeInsertRow)if(_b==null)if(g.beforeInsertRow(ad)==false)return false;var rId=g.gB._1();var c=g.cols;var a=g.aCols;if(!b._kH){var kgs=new Array();for(var i in c){if(c[i].keyGen!=''){kgs[kgs.length]=this.id+"_"+c[i].id+"<:>"+c[i].keyGen;};};if(kgs.length>0){valHalt=true;b._kH=true;b._kL=true;b._tG=g;b._tP1=_b;b._tP2=ad;var f=window.frames[b.id+'Sync'].document.forms['frm1'];f.keyGenList.value=kgs.join("<|>");f.submit();return rId;};}else{var nk=b.newKeys.split("|");var s=0;for(var i in c)if(c[i].keyGen!=''){c[i].Q=nk[s];s++};b._kH=null;valHalt=false;};this.sRS(rId,"i");if(ad){if(_b){for(var key in _b){var j=a[key].vs;j[j.length]=(_b[key]==null)?a[key].P(a[key].idx):_b[key]};}else{for(var i in c)c[i].vs=_0(c[i].vs,c[i].vs.length,c[i].P(i));};for(var i in c)c[i].vsS[c[i].vsS.length]=null;g.rows[g.rows.length]=rId;var nd=g.tB.appendChild(g.W(g.rows.length-1,rId));g.tB.appendChild(g.V(rId));}else{if(g.tB.childNodes.length==1)return false;if(_b){for(var key in _b)a[key].vs=_0(a[key].vs,g.y,(_b[key]==null)?a[key].P(a[key].idx):_b[key]);}else{for(var i in c)c[i].vs=_0(c[i].vs,g.y,c[i].P(i));};for(var i in c)c[i].vsS=_0(c[i].vsS,g.y,null);var tr=g.gB.getTr(g.rows[g.y]);g.rows=_0(g.rows,g.y,rId);var nd=g.tB.insertBefore(g.V(rId),tr);var nd=g.tB.insertBefore(g.W(g.y,rId),nd);};if(g.onRowsChange)g.onRowsChange(rId,"i");for(var i in c)if(c[i].onValueChange)c[i].onValueChange();if(b.onValueChange)b.onValueChange();if(!_b)c[g._4()].tdClick(nd.childNodes[g._4()+1],rId);if(g.bTpl)window.setTimeout("__wGSFF(window.aTd)",0);return rId;};function _0(a,p,v){var b=a.slice(0,p);var e=a.slice(p);b[b.length]=v;return b.concat(e)};grid.prototype.delRow=function(rId,clic){var g=this;if(g.gRS(rId)!='i'&&g.J==false){alert("You are not allowed to delete rows.");return false};if(valHalt||g.tB.childNodes.length==1)return;if(rId)g.y=g.transRId(rId);if(g.onDeleteRow)if(!g.onDeleteRow(g.rows[g.y]))return false;var dNd=g.gB.getTr(g.rows[g.y]);var nNd=dNd.nextSibling.nextSibling;var p=dNd.previousSibling;if((!nNd)&&p)nNd=p.previousSibling;var p=g.tB.parentNode;p.deleteRow(dNd.rowIndex+1);p.deleteRow(dNd.rowIndex);g._j(g.y);g.sRS(g.rows[g.y],"d");if(g.onRowsChange)g.onRowsChange(null,"d");if(clic&&nNd)g.cols[g._4()].tdClick(nNd.childNodes[g._4()+1],nNd.id);for(var i in g.cols)if(g.cols[i].onValueChange)g.cols[i].onValueChange();if(this.gB.onValueChange)this.gB.onValueChange();};grid.prototype._j=function(pY){for(var i in this.M){var g=this.M[i];if(!g.J)continue;var k1=this._c[i].split(";");var dR=new Array();for(var y in g.rows){var del="";for(var l in k1){var k2=k1[l].split("=");del+=(g.aCols[k2[0]].vs[y]==this.aCols[k2[1]].vs[pY])?"1":"0";};if(del.indexOf("0")==-1){g._j(y);dR[dR.length]=g.rows[y];};};for(var r in dR)g.sRS(dR[r],"d");};};grid.prototype.delRowVs=function(y){this.rows=N(this.rows,Number(y));for(var i in this.aCols){this.aCols[i].vs=N(this.aCols[i].vs,Number(y));this.aCols[i].vsS=N(this.aCols[i].vsS,Number(y));};};grid.prototype.sRS=function(rId,s){var e=this.gRS(rId);var y=this.transRId(rId);if(e!="i"||(!s)){this._3[rId]=s;if(!s)for(var c in this.cols)this.cols[c].vsS[y]=null;}else{if(s=="d"){this._3[rId]=null;this.delRowVs(y);};};};function N(a,p){var b=a.slice(0,p);var e=a.slice(p+1);return b.concat(e)};grid.prototype.evalKey=function(key,y){if(key){var a=this.aCols;var q=key.split(";");for(var k in q){var vs=q[k].split("=");if(!(a[vs[0]].vs[y]==vs[1]))return false;};};return true;};column.prototype.P=function(){var g=this.grid;var t=g.tB.parentNode;if(t.id){var k=t.id.split(";");for(var i in k){var sp=k[i].split("=");if(g.aCols[sp[0]]==this)return sp[1];};};return (this.getDefault)?this.getDefault():this.Q;};grid.prototype.O=function(i,y){var k="";var k1=this._c[i].split(";");for(var l in k1){var k2=k1[l].split("=");k2[1]=this.aCols[k2[1]].vs[y];k+=k2.join("=")+";";};return k.substr(0,k.length-1);};grid.prototype.W=function(y,rId){var nd=this.gB.Y("TR");nd.id=rId;nd.className=this.id+"1";var nd3=nd.appendChild(this.gB.Y("TD"));nd3.innerHTML=(this.M.length>0)?"<a href=\"javascript:"+this._9+".expand("+rId+")\"><img hspace='2' src='"+this.C.src+"' border='0'></a>":"";nd3.className=this.id;var c=this.cols;if(this.bTpl){var h=new Array();h[0]=c[0];}else{var h=c;};for(var i in h){var nd2=nd.appendChild(this.gB.Y(((document.all)?"<TD onClick=tdClick(this,"+this.idx+",'"+h[i].id+"',"+rId+")>":"TD")));nd2.align=h[i].align;nd2.className=this.id;if(h[i].bgColor!='#')nd2.bgColor=h[i].bgColor;if(h[i].width>0)nd2.width=h[i].width+"px";if(!document.all)nd2.setAttribute("onClick","tdClick(this,"+this.idx+",'"+h[i].id+"',"+rId+")");if(!h[i].vi)nd2.style.display="none";if(this.bTpl){var t=this.bTpl;for(var x in c)t=c[x].gCellCode(y,rId,true,t);nd2.innerHTML=t;}else{nd2.innerHTML=h[i].gCellCode(y,rId,false);};};return nd;};grid.prototype.V=function(rId){var nd=this.gB.Y("TR");nd.id="sub"+rId;nd.style.display="none";var nd2=nd.appendChild(this.gB.Y("TD"));nd2.innerTEXT="&nbsp;";nd2=nd.appendChild(this.gB.Y("TD"));nd2.colSpan=this._5();nd2.style.background=(this.M.length>0)?this.M[0].bgCol:this.bgCol;return nd;};gridBox.prototype.Y=function(v){return this.doc.createElement(v)};gridBox.prototype.getTr=function(rId){var nd=this.doc.getElementById(rId);return nd};function Z(sNd,nN){while(sNd.nodeName!=nN)sNd=sNd.parentNode;return sNd};gridBox.prototype._1=function(){this.K+=1;return this.K};grid.prototype.gRS=function(rId){return this._3[rId]};grid.prototype.transRId=function(rId){for(var t in this.rows){if(this.rows[t]==rId){return t}}};grid.prototype._4=function(){for(var i=0;i<this.cols.length;i++)if(this.cols[i].vi)return i};grid.prototype._5=function(){var n=0;for(var i in this.cols){if(this.cols[i].vi)n+=1}return (this.bTpl)?1:n};function __nSort(a,b){return a[0]-b[0]};function __wGSFF(o){if(!o)return;var c=o.childNodes;for(var i=0;i<c.length;i++){var n=c[i];m=n.nodeName;if(m!='DIV'&&m!='NOBR'&&m!='TABLE'&&m!='TBODY'&&m!='TD'&&m!='TR'&&m!='TH'){if(n.focus){try{n.focus();n.select()}catch(e){};return true;};};if(__wGSFF(n))return true;};};